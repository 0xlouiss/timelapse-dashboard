# Timelapse Dashboard

A full-featured web dashboard for controlling a Raspberry Pi timelapse script with real-time monitoring and video generation.

![Dashboard Screenshot](https://github.com/user-attachments/assets/9c55f38a-bccf-4afc-aadd-01dffba7b579)

## Features

- ‚úÖ **Real-time Monitoring**: Live status updates via Server-Sent Events (SSE)
- üìπ **Timelapse Control**: Start/stop timelapse captures with customizable parameters
- üìä **Progress Tracking**: Visual progress bars and frame counters
- üìù **Live Logs**: Real-time log streaming from the timelapse script
- üñºÔ∏è **Image Gallery**: Auto-refreshing gallery of captured frames
- üé¨ **Video Generation**: Automatic MP4 video creation using ffmpeg
- üíæ **Video Download**: Download completed timelapse videos
- üåì **Dark Mode**: Toggle between light and dark themes
- üì± **Responsive Design**: Bootstrap-based UI that works on all devices
- ‚ö†Ô∏è **Error Handling**: Clear error messages and graceful failure handling

## Screenshots

### Light Mode
![Light Mode](https://github.com/user-attachments/assets/9c55f38a-bccf-4afc-aadd-01dffba7b579)

### Dark Mode
![Dark Mode](https://github.com/user-attachments/assets/a24ad981-5fc1-4c9c-aa2d-cdd7c005c2ed)

### Image Gallery
![Gallery View](https://github.com/user-attachments/assets/dee9b537-3fd3-4b7f-8c38-9fa5f68dfbe1)

## Project Structure

```
timelapse-dashboard/
‚îú‚îÄ‚îÄ timelapse.py           # Flask backend application
‚îú‚îÄ‚îÄ timelapse.sh           # Bash script for timelapse capture
‚îú‚îÄ‚îÄ requirements.txt       # Python dependencies
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ index.html        # Main dashboard HTML template
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ script.js         # Frontend JavaScript (SSE, UI logic)
‚îÇ   ‚îî‚îÄ‚îÄ style.css         # Custom CSS styles
‚îî‚îÄ‚îÄ timelapse_status.json # Status file (generated by script)
```

## Requirements

### Software Dependencies

- Python 3.7+
- Flask 3.0.0
- ffmpeg (for video generation)
- ImageMagick (optional, for test images)
- raspistill (on Raspberry Pi with camera)

### Hardware (for production)

- Raspberry Pi (any model with camera support)
- Raspberry Pi Camera Module

## Installation

### On Raspberry Pi

1. **Clone the repository:**
   ```bash
   git clone https://github.com/0xlouiss/timelapse-dashboard.git
   cd timelapse-dashboard
   ```

2. **Install Python dependencies:**
   ```bash
   pip3 install -r requirements.txt
   ```

3. **Install system dependencies:**
   ```bash
   sudo apt-get update
   sudo apt-get install -y ffmpeg imagemagick
   ```

4. **Configure paths (optional):**
   
   By default, the dashboard uses local directories for development. For production on Raspberry Pi:
   
   Edit `timelapse.py` and uncomment the production paths:
   ```python
   # For production on Raspberry Pi, uncomment these:
   STATUS_FILE = "/mnt/share/timelapse_status.json"
   TIMELAPSE_SCRIPT = "/usr/local/bin/timelapse.sh"
   ```

5. **Copy the timelapse script to system location (optional):**
   ```bash
   sudo cp timelapse.sh /usr/local/bin/
   sudo chmod +x /usr/local/bin/timelapse.sh
   ```

6. **Create data directory:**
   ```bash
   sudo mkdir -p /mnt/share
   sudo chown pi:pi /mnt/share
   ```

### For Development/Testing

1. **Clone and install:**
   ```bash
   git clone https://github.com/0xlouiss/timelapse-dashboard.git
   cd timelapse-dashboard
   pip3 install -r requirements.txt
   ```

2. **Install ffmpeg and imagemagick:**
   ```bash
   # Ubuntu/Debian
   sudo apt-get install -y ffmpeg imagemagick
   
   # macOS
   brew install ffmpeg imagemagick
   ```

3. **Run the dashboard:**
   ```bash
   python3 timelapse.py
   ```

4. **Access the dashboard:**
   Open your browser and navigate to `http://localhost:5000`

## Usage

### Starting a Timelapse

1. Open the dashboard in your browser
2. Set the **Interval** (seconds between captures)
3. Set the **Number of Frames** to capture
4. Click **Start Timelapse**
5. Monitor progress in real-time

### Monitoring Progress

- **Status Panel**: Shows current status (idle, running, rendering, done, error)
- **Progress Bar**: Visual representation of capture progress
- **Live Logs Tab**: Real-time logs from the timelapse script
- **Image Gallery Tab**: Preview of captured frames

### Downloading Video

Once the timelapse is complete and video is rendered:
1. The video player will appear in the "Video Output" section
2. Click the **Download Video** button to save the MP4 file

### Dark Mode

Click the moon/sun icon in the top right corner to toggle between light and dark themes.

## Configuration

### Timelapse Script Parameters

The `timelapse.sh` script accepts two arguments:

```bash
./timelapse.sh [interval] [frames]
```

- `interval`: Time in seconds between captures (default: 5)
- `frames`: Total number of frames to capture (default: 10)

### Environment Variables

Set `BASE_DIR` to customize where timelapse data is stored:

```bash
export BASE_DIR=/custom/path
./timelapse.sh 5 100
```

### Flask Configuration

Edit `timelapse.py` to customize:

- `STATUS_FILE`: Path to status JSON file
- `TIMELAPSE_SCRIPT`: Path to timelapse script
- Port and host in `app.run()`

## API Endpoints

The dashboard provides the following REST and SSE endpoints:

### REST Endpoints

- `GET /` - Main dashboard page
- `POST /start` - Start timelapse (JSON: `{interval, frames}`)
- `POST /stop` - Stop running timelapse
- `GET /status` - Get current status
- `GET /logs` - Get log entries
- `GET /thumbnails` - Get list of captured images
- `GET /video` - Get video information
- `GET /frames/<filename>` - Serve frame image
- `GET /video_file/<filename>` - Stream video file
- `GET /download_video/<filename>` - Download video file

### SSE Endpoints

- `GET /stream/status` - Real-time status updates
- `GET /stream/logs` - Real-time log streaming

## Troubleshooting

### Camera Not Found

If you see "raspistill not found" on Raspberry Pi:
```bash
# Enable camera interface
sudo raspi-config
# Navigate to Interface Options > Camera > Enable
```

### Permission Denied

If you get permission errors:
```bash
sudo chown -R pi:pi /mnt/share
chmod +x timelapse.sh
```

### Port Already in Use

Change the port in `timelapse.py`:
```python
app.run(host="0.0.0.0", port=8080, debug=True)
```

### FFmpeg Not Creating Video

Ensure ffmpeg is installed and working:
```bash
ffmpeg -version
```

## Production Deployment

For production use, consider:

1. **Use a production WSGI server:**
   ```bash
   pip install gunicorn
   gunicorn -w 4 -b 0.0.0.0:5000 timelapse:app
   ```

2. **Set up as a systemd service:**
   ```bash
   sudo nano /etc/systemd/system/timelapse-dashboard.service
   ```
   
   ```ini
   [Unit]
   Description=Timelapse Dashboard
   After=network.target
   
   [Service]
   User=pi
   WorkingDirectory=/home/pi/timelapse-dashboard
   ExecStart=/usr/local/bin/gunicorn -w 4 -b 0.0.0.0:5000 timelapse:app
   Restart=always
   
   [Install]
   WantedBy=multi-user.target
   ```
   
   ```bash
   sudo systemctl enable timelapse-dashboard
   sudo systemctl start timelapse-dashboard
   ```

3. **Set up nginx reverse proxy (optional):**
   ```nginx
   server {
       listen 80;
       server_name your-pi.local;
       
       location / {
           proxy_pass http://127.0.0.1:5000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```

## License

MIT License - feel free to use and modify as needed.

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## Acknowledgments

- Bootstrap for the responsive UI framework
- Flask for the lightweight web framework
- ffmpeg for video processing
